<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ad</title>
    <style>
        * {
            margin: 0;
        }
        
        body {
            padding: 10px;
        }
        
        .but {
            border: 0px solid #999;
            background-color: cadetblue;
            color: #fff;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 6px;
            margin: 5px;
        }
        
        .line {
            margin: 10px;
            border-bottom: 1px solid #999;
        }
    </style>
</head>

<body>
    <h4>我是h5~~</h4>
    <div id="title"></div>
    <div id="title2"></div>
    <h5>收到快应用注入的消息：</h5>
    <div id="log"></div>
    <div class="line"></div>
    <input type="button" value="判断app是否安装" class="but" id="verdict" />
    <input type="button" value="下载app" class="but" id="download" />
    <input type="button" value="获取下载状态" class="but" id="getStatus" />
</body>
<script>
    const pkg = `com.baidu.BaiduMap`
    let downloadAppStatus = '下载app'

    const statusEnum = new Map([
        [-1, '下载app'],
        [0, '安装'],
        [1, '安装进度'],
    ])

    if (!window.system) {
        document.querySelector('#title').innerHTML = `<span>网页里面没有system对象</span>`;
    } else {
        document.querySelector('#title').innerHTML = `<span>网页已经被注入system对象</span>`;
    }
    const system = window.system;


    document.querySelector('#verdict').onclick = function() {
        system.postMessage(`{broadcastToQa:${JSON.stringify({
            verdictPkgExist: {
                package: pkg
            }
        })}}`)
    }

    document.querySelector('#download').onclick = function() {
        system.postMessage(JSON.stringify({
            broadcastToQa: {
                downloadPackage: {
                    package: pkg
                }
            }
        }))
    }

    document.querySelector('#getStatus').onclick = function() {

        system.postMessage(JSON.stringify({
            broadcastToQa: {
                getDownloadStatus: {
                    package: pkg
                }
            }
        }))

    }

    function analyticParams(param) {
        console.log(nowFeildName);
    }
    setTimeout(() => {
        const nowFeildName = statusEnum.get(1)
        document.querySelector('#download').value = nowFeildName
    }, 2000)
    system.onmessage = function(data) {
        analyticParams(data)
        document.querySelector('#log').innerHTML = `<span>${data}</span>`
    }
</script>

</html>